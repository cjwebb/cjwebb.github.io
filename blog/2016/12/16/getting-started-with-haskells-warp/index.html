
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Getting Started with Haskell's Warp - cjwebb.github.io</title>
  <meta name="author" content="Colin Webb">

  
  <meta name="description" content="I recently started playing with Haskell&rsquo;s Warp in my effort to learn Haskell. Warp is small and fast web server, and doesn&rsquo;t come bundled &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cjwebb.github.io/blog/2016/12/16/getting-started-with-haskells-warp">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="cjwebb.github.io" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41253515-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">cjwebb.github.io</a></h1>
  
    <h2>I write software, teach people, and investigate new technology</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:cjwebb.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Getting Started With Haskell's Warp</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-12-16T21:00:00+00:00" pubdate data-updated="true"></time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I recently started playing with Haskell&rsquo;s <a href="http://www.aosabook.org/en/posa/warp.html">Warp</a> in my effort to learn Haskell. Warp is small and fast web server, and doesn&rsquo;t come bundled with much. It also has no &ldquo;magic&rdquo; in it, which I think is a very good thing.</p>

<p>My hello-world program for any web server, is to respond with <code>{"hello":"world"}</code>. Here it is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="cm">{-# LANGUAGE OverloadedStrings #-}</span>
</span><span class='line'><span class="cm">{-# LANGUAGE DeriveGeneric, DeriveAnyClass #-}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>
</span><span class='line'>
</span><span class='line'><span class="kr">import</span> <span class="nn">Network.Wai</span> <span class="p">(</span><span class="nf">responseLBS</span><span class="p">,</span> <span class="kt">Application</span><span class="p">,</span> <span class="kt">Response</span><span class="p">,</span> <span class="nf">rawPathInfo</span><span class="p">)</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Network.Wai.Handler.Warp</span> <span class="p">(</span><span class="nf">run</span><span class="p">)</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Network.HTTP.Types</span> <span class="p">(</span><span class="nf">status200</span><span class="p">,</span> <span class="nf">status404</span><span class="p">)</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Network.HTTP.Types.Header</span> <span class="p">(</span><span class="nf">hContentType</span><span class="p">)</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Data.Aeson</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">GHC.Generics</span>
</span><span class='line'>
</span><span class='line'><span class="kr">data</span> <span class="kt">Hello</span> <span class="ow">=</span> <span class="kt">Hello</span> <span class="p">{</span> <span class="n">hello</span> <span class="ow">::</span> <span class="kt">String</span> <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">ToJSON</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="kr">let</span> <span class="n">port</span> <span class="ow">=</span> <span class="mi">3000</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Listening on port &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">port</span>
</span><span class='line'>  <span class="n">run</span> <span class="n">port</span> <span class="n">app</span>
</span><span class='line'>
</span><span class='line'><span class="nf">app</span> <span class="ow">::</span> <span class="kt">Application</span>
</span><span class='line'><span class="nf">app</span> <span class="n">req</span> <span class="n">res</span> <span class="ow">=</span>
</span><span class='line'>  <span class="n">res</span> <span class="o">$</span> <span class="kr">case</span> <span class="n">rawPathInfo</span> <span class="n">req</span> <span class="kr">of</span>
</span><span class='line'>    <span class="s">&quot;/&quot;</span> <span class="ow">-&gt;</span> <span class="n">helloRoute</span>
</span><span class='line'>    <span class="kr">_</span>   <span class="ow">-&gt;</span> <span class="n">notFoundRoute</span>
</span><span class='line'>
</span><span class='line'><span class="nf">helloRoute</span> <span class="ow">::</span> <span class="kt">Response</span>
</span><span class='line'><span class="nf">helloRoute</span> <span class="ow">=</span>
</span><span class='line'>  <span class="n">responseLBS</span>
</span><span class='line'>  <span class="n">status200</span>
</span><span class='line'>  <span class="p">[(</span><span class="n">hContentType</span><span class="p">,</span> <span class="s">&quot;application/json&quot;</span><span class="p">)]</span>
</span><span class='line'>  <span class="o">.</span> <span class="n">encode</span> <span class="o">$</span> <span class="kt">Hello</span> <span class="s">&quot;World&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nf">notFoundRoute</span> <span class="ow">::</span> <span class="kt">Response</span>
</span><span class='line'><span class="nf">notFoundRoute</span> <span class="ow">=</span>
</span><span class='line'>  <span class="n">responseLBS</span>
</span><span class='line'>  <span class="n">status404</span>
</span><span class='line'>  <span class="p">[(</span><span class="n">hContentType</span><span class="p">,</span> <span class="s">&quot;application/json&quot;</span><span class="p">)]</span>
</span><span class='line'>  <span class="s">&quot;404 - Not Found&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, the code has a <code>main</code> function that runs the <code>app</code>. This <code>app</code> just matches on routes, and responds with <code>HTTP 200 OK</code> on the root, or <code>HTTP 404 Not Found</code>. These are returned by different functions which returning <code>Response</code> types, and contain most of the hard parts of this code.</p>

<p>Talking of hard parts, the thing I had the most difficultly with was:</p>

<h3>Working out what <code>responseLBS</code> meant, and how to use it</h3>

<p><code>responseLBS</code> means &ldquo;respond with a LazyByteString&rdquo;. LazyByteString seems to be the standard way of dealing with Strings in Warp. Their laziness, and serialisation format, apparently yields very high performance.</p>

<p>However, using them is not so simple. Unless you convert from a normal String to a LazyByteString, you receive this compiler error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Couldn't match expected type
</span><span class='line'>‘bytestring-0.10.8.1:Data.ByteString.Internal.ByteString’
</span><span class='line'>with actual type ‘[Char]’</span></code></pre></td></tr></table></div></figure>


<p>The <code>OverloadedStrings</code> pragma on the first line makes responseLBS usable, but providing a typeclass that automatically converts Strings to LazyByteStrings. It took me a while to realise this.</p>

<h2>Summary</h2>

<p>One of the best things about this code was the experience writing it. Once it compiled, it worked. It took a while to work out, but it was all helpfully guided by the compiler.</p>

<p>I think I&rsquo;d probably benefit from an IDE for Haskell, as I spend much of my time in IntelliJ coding Scala. Discovering the necessary imports was the trickiest part of coding in the Atom Editor. If you have any recommendations, please send them my way!</p>

<p>IDE&rsquo;s aside, if coding in Haskell is always this pleasant, I&rsquo;ll be very pleased!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Colin Webb</span></span>

      








  


<time datetime="2016-12-16T21:00:00+00:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/haskell/'>haskell</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cjwebb.github.io/blog/2016/12/16/getting-started-with-haskells-warp/" data-via="colinjameswebb" data-counturl="http://cjwebb.github.io/blog/2016/12/16/getting-started-with-haskells-warp/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/06/28/learning-akka-streams/" title="Previous Post: Learning Akka Streams">&laquo; Learning Akka Streams</a>
      
      
        <a class="basic-alignment right" href="/blog/2017/01/02/dynamodb-scala-macros/" title="Next Post: DynamoDB with Scala Macros">DynamoDB with Scala Macros &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/01/02/dynamodb-scala-macros/">DynamoDB With Scala Macros</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/16/getting-started-with-haskells-warp/">Getting Started With Haskell's Warp</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/06/28/learning-akka-streams/">Learning Akka Streams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/06/15/the-virtues-of-side-projects/">The Virtues of Side Projects</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/01/elm-in-octopress/">Using Elm in Octopress</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>About Me</h1>
  <p>My name is Colin Webb, and I'm a software consultant.</p>
  <p>I write software, teach people, and investigate new technology.</p>

  <p>You can find me on Twitter <a href="http://twitter.com/colinjwebb">@colinjwebb</a>, or generally online at <a href="http://colinjameswebb.com">colinjameswebb.com</a></p>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Colin Webb -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'cjwebbgithubio';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://cjwebb.github.io/blog/2016/12/16/getting-started-with-haskells-warp/';
        var disqus_url = 'http://cjwebb.github.io/blog/2016/12/16/getting-started-with-haskells-warp/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
